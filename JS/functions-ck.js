var data,container,node,svg,resetContent;$.fn.redraw=function(){$(this).each(function(){var e=this.offsetHeight})};var p,init=function(){drawIcons();window.setTimeout(function(){},1e3);$("#footer").on("click","#button.phase1",function(){phase2Transition();$(this).toggleClass("phase1 phase2")});$("#footer").on("click","#button.phase2",function(){$(this).toggleClass("phase2 phase3");$(this).find("h3").text("RESET");phase3Transition()});$("#footer").on("click","#button.phase3",function(){$("#container").addClass("loading");location.reload()})},duration=300;jQuery.easing.def="easeInCirc";var $selected,selected=[],getTileData=function(){$selected=$(".inBin");numSelected=$selected.length;$selected.each(function(e,t){var n=$(t).prop("__data__");n.weight=100/numSelected;selected.push(n)});return selected},makePie=function(){binW=$(".bin").width();p=new inPie(binW,binW);p.build(".bin",selected,icons);$("#button").toggleClass("noclick");$(document).on("RATE",function(e){var t=e.rate;$(".live_rate").text(t).parent().toggleClass("inactive",!1).redraw()})},phase2Transition=function(){$("#button").toggleClass("noclick");getTileData();$tiles=$(".tile:not(.inBin)");numtiles=$tiles.length;$tiles.each(function(e,t){var n=numtiles-e;$(t).delay(duration*(n/(3+Math.random()))).animate({top:"+=768"},duration,"easeInCirc")}).delay(1e3).queue(function(){$(this).remove()});off=$(".left").width();delayDuration=duration*numtiles/3;$("#container").delay(delayDuration).queue(function(e){$(this).addClass("phase2")});$(".bin").delay(delayDuration+1e3).queue(function(e){$(this).addClass("phase2").delay(1e3);setTimeout(makePie,1e3)});$(".right").find("h1, h2").delay(delayDuration/2).queue(function(e){$(this).addClass("inactive");$selected.each(function(e,t){$(this).find("p").css("opacity","0");$(this).find("svg, .icon, p").animate({width:"0px",height:"0px","pointer-events":"none"},duration,function(){$(this).remove()})}).delay(1e3).queue(function(){$(this).remove()})})},phase3Transition=function(){var e="HOW DOES YOUR RATE COMPARE?",t="You might be spending money on things that have a different inflation rate from the national rate.";$(".phase2.heading").text(e).redraw();$(".phase2.body").text(t).redraw();$(".natl.rate, .lab").removeClass("inactive");$(".prompt").removeClass("inactive");p.addClickHandlers()},icons={},drawIcons=function(){container=d3.select(".left");tile=container.selectAll("div").data(data_json).enter().append("div").attr("class","tile");tile.append("div").attr("class","icon").attr("id",function(e){return e.ser_id});tile.select(".icon").each(function(e){var t="SVG/"+e.ser_id+".svg";d3.xml(t,"image/svg+xml",function(t){node=document.importNode(t.documentElement,!0);$(node).find("path, circle, polygon, line").attr("fill","#A4DBE8");icons[e.ser_id]=node;document.getElementById(e.ser_id).appendChild(node)})});tile.append("p").text(function(e){return e.program_name});$(".tile").draggable({create:function(e,t){$this=$(this);thisPos=$this.offset()},start:function(e,t){$(this).find(".icon").toggleClass("active",!0);$(this).find("p").fadeOut(200)},stop:function(e,t){$this=$(this);$this.find(".icon").toggleClass("active",!1);$this.find("p").fadeIn(200);$this.hasClass("inBin")||$this.animate({left:0,top:0})}});$(".bin").droppable({accept:".tile",activeClass:"active",hoverClass:"drop-hover",tolerance:"fit",drop:function(e,t){if($(".inBin").length>=5){alert("You've already got 5 items, you'll need to remove one to add any more.");return!1}var n=$(".inBin").length>0;$("#button").toggleClass("inactive",!n);t.draggable.toggleClass("inBin",!0);$(".lab").toggleClass("inactive",!0)}});$(".left").droppable({accept:".inBin",activeClass:".active",hoverClass:".drop-hover",drop:function(e,t){t.draggable.toggleClass("inBin",!1)}});$("#container").removeClass("loading")};